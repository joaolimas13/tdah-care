<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TDAH Care</title>
<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-title" content="TDAH Care">
<meta name="application-name" content="TDAH Care">
<link rel="manifest" href="manifest.json">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --primary: #1565C0; --primary-light: #1976D2; --primary-dark: #0D47A1;
    --accent: #29B6F6; --bg: #F0F4F8; --text: #1A237E; --text-light: #546E7A;
    --success: #2E7D32; --shadow: 0 2px 12px rgba(21,101,192,0.10); --radius: 16px;
  }
  body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; max-width: 430px; margin: 0 auto; }

  .header { background: linear-gradient(135deg, var(--primary-dark), var(--primary-light)); color: white; padding: 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
  .header h1 { font-size: 1.3rem; font-weight: 700; }
  .header span { font-size: 0.8rem; opacity: 0.85; display: block; }

  .nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 430px; background: white; display: flex; box-shadow: 0 -2px 12px rgba(21,101,192,0.12); z-index: 100; }
  .nav-btn { flex: 1; padding: 12px 4px; border: none; background: none; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 3px; font-size: 0.65rem; color: var(--text-light); transition: all 0.2s; }
  .nav-btn .icon { font-size: 1.4rem; }
  .nav-btn.active { color: var(--primary); }
  .nav-btn.active .icon { transform: translateY(-2px); }

  .page { display: none; padding: 20px; padding-bottom: 80px; }
  .page.active { display: block; }

  .card { background: white; border-radius: var(--radius); padding: 20px; margin-bottom: 16px; box-shadow: var(--shadow); }
  .card-title { font-size: 0.85rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 14px; }

  .greeting { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border-radius: var(--radius); padding: 20px; margin-bottom: 16px; }
  .greeting h2 { font-size: 1.2rem; margin-bottom: 4px; }
  .greeting p { font-size: 0.85rem; opacity: 0.9; }

  .stats-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 16px; }
  .stat-card { background: white; border-radius: 12px; padding: 14px 10px; text-align: center; box-shadow: var(--shadow); }
  .stat-icon { font-size: 1.5rem; margin-bottom: 4px; }
  .stat-value { font-size: 1.2rem; font-weight: 700; color: var(--primary); }
  .stat-label { font-size: 0.65rem; color: var(--text-light); }

  .form-group { margin-bottom: 16px; }
  label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 6px; color: var(--text); }
  input, select, textarea { width: 100%; padding: 12px 14px; border: 2px solid #E3EAF2; border-radius: 10px; font-size: 0.95rem; outline: none; transition: border 0.2s; background: #F8FAFF; }
  input:focus, select:focus, textarea:focus { border-color: var(--primary); background: white; }
  textarea { resize: none; height: 80px; }

  .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.2s; }
  .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; }
  .btn-primary:active { transform: scale(0.98); }
  .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }

  /* REM√âDIO */
  .remedio-card { background: linear-gradient(135deg, #E3F2FD, #F0F7FF); border-radius: var(--radius); padding: 20px; margin-bottom: 16px; border: 2px solid #BBDEFB; }
  .remedio-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
  .remedio-title { font-weight: 700; color: var(--primary); font-size: 0.95rem; }
  .remedio-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
  .badge-ativo { background: #E8F5E9; color: #2E7D32; }
  .badge-inativo { background: #FFEBEE; color: #C62828; }
  .badge-encerrado { background: #FFF8E1; color: #F57F17; }

  .remedio-progress-bar { height: 14px; background: #E3EAF2; border-radius: 7px; overflow: hidden; }
  .remedio-progress-fill { height: 100%; border-radius: 7px; transition: width 1s ease; position: relative; }
  .remedio-progress-fill::after { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent); animation: shimmer 2s infinite; }
  @keyframes shimmer { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }

  .remedio-info-row { display: flex; justify-content: space-between; font-size: 0.78rem; color: var(--text-light); margin-top: 6px; }
  .remedio-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
  .remedio-stat { background: white; border-radius: 10px; padding: 10px; text-align: center; }
  .remedio-stat .val { font-size: 1.1rem; font-weight: 700; color: var(--primary); }
  .remedio-stat .lbl { font-size: 0.7rem; color: var(--text-light); }

  .aviso-encerrado { background: #FFF8E1; border: 2px solid #FFE082; border-radius: 12px; padding: 16px; margin-top: 12px; display: none; }
  .aviso-encerrado h4 { color: #F57F17; font-size: 0.9rem; margin-bottom: 8px; }
  .aviso-encerrado p { font-size: 0.82rem; color: #5D4037; line-height: 1.6; }
  .aviso-encerrado.show { display: block; }

  .time-input-wrap { display: flex; gap: 10px; align-items: flex-end; }
  .time-input-wrap input[type="time"] { flex: 1; }
  .time-input-wrap button { padding: 12px 18px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 0.9rem; font-weight: 700; cursor: pointer; white-space: nowrap; }

  /* SONO */
  .sono-visual { display: flex; align-items: center; justify-content: center; gap: 16px; padding: 16px 0; }
  .sono-circle { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-dark), var(--accent)); display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; box-shadow: 0 4px 16px rgba(21,101,192,0.35); }
  .sono-circle .horas { font-size: 1.8rem; font-weight: 800; }
  .sono-circle .label { font-size: 0.65rem; opacity: 0.85; }
  .sono-info p { font-size: 0.85rem; color: var(--text-light); margin-bottom: 4px; }
  .sono-info strong { color: var(--primary); }

  .hours-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 10px 0; }
  .hour-btn { padding: 10px; border: 2px solid #E3EAF2; border-radius: 10px; background: #F8FAFF; font-size: 0.85rem; font-weight: 600; cursor: pointer; text-align: center; transition: all 0.2s; color: var(--text); }
  .hour-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }
  .custom-hours { display: flex; gap: 8px; align-items: center; margin-top: 8px; }
  .custom-hours input { flex: 1; }
  .custom-hours span { font-size: 0.85rem; color: var(--text-light); white-space: nowrap; }

  /* METAS */
  .meta-item { display: flex; align-items: center; gap: 12px; padding: 14px; background: #F8FAFF; border-radius: 12px; margin-bottom: 10px; border: 2px solid transparent; transition: all 0.2s; cursor: pointer; }
  .meta-item.done { background: #E8F5E9; border-color: #A5D6A7; }
  .meta-check { width: 26px; height: 26px; border-radius: 50%; border: 2px solid #B0BEC5; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; }
  .meta-item.done .meta-check { background: var(--success); border-color: var(--success); color: white; }
  .meta-text { flex: 1; }
  .meta-title { font-size: 0.9rem; font-weight: 600; }
  .meta-sub { font-size: 0.75rem; color: var(--text-light); }

  .progress-bar { height: 8px; background: #E3EAF2; border-radius: 4px; overflow: hidden; margin: 8px 0; }
  .progress-fill { height: 100%; background: linear-gradient(to right, var(--primary), var(--accent)); border-radius: 4px; transition: width 0.4s; }
  .progress-info { display: flex; justify-content: space-between; font-size: 0.78rem; color: var(--text-light); }

  .add-meta { display: flex; gap: 8px; margin-bottom: 16px; }
  .add-meta input { flex: 1; }
  .add-meta button { padding: 12px 16px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; }

  .historico-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #EEF2F7; }
  .historico-item:last-child { border-bottom: none; }
  .historico-data { font-size: 0.8rem; color: var(--text-light); }
  .badge { padding: 3px 10px; border-radius: 20px; font-size: 0.72rem; font-weight: 600; }
  .badge-good { background: #E8F5E9; color: #2E7D32; }
  .badge-warn { background: #FFF8E1; color: #F57F17; }
  .badge-bad { background: #FFEBEE; color: #C62828; }

  .info-tabs { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 4px; }
  .info-tab { padding: 8px 14px; border-radius: 20px; border: 2px solid #E3EAF2; background: white; font-size: 0.8rem; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
  .info-tab.active { background: var(--primary); color: white; border-color: var(--primary); }
  .info-content { display: none; }
  .info-content.active { display: block; }
  .info-card { background: #F0F7FF; border-left: 4px solid var(--primary); border-radius: 0 12px 12px 0; padding: 16px; margin-bottom: 12px; }
  .info-card h3 { font-size: 0.95rem; color: var(--primary); margin-bottom: 8px; }
  .info-card p { font-size: 0.85rem; color: var(--text-light); line-height: 1.6; }
  .info-tip { background: #FFF8E1; border-left: 4px solid #FFB300; border-radius: 0 12px 12px 0; padding: 12px 16px; margin-bottom: 10px; font-size: 0.83rem; color: #5D4037; line-height: 1.5; }
  .info-tip strong { color: #E65100; }

  .toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); background: #1A237E; color: white; padding: 12px 24px; border-radius: 24px; font-size: 0.85rem; font-weight: 600; z-index: 999; opacity: 0; transition: opacity 0.3s; white-space: nowrap; box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
  .toast.show { opacity: 1; }
  .section-title { font-size: 1rem; font-weight: 700; color: var(--text); margin-bottom: 12px; }
  .divider { height: 1px; background: #EEF2F7; margin: 16px 0; }

  /* RESET BTN */
  .btn-danger { background: transparent; border: 2px solid #EF5350; color: #EF5350; border-radius: 12px; padding: 10px; font-size: 0.8rem; font-weight: 700; cursor: pointer; width: 100%; margin-top: 8px; }

  /* Modo Caverna */
  .pomodoro-card { text-align: center; }
  .pomodoro-timer { font-size: 3rem; font-weight: 800; color: var(--primary); margin-bottom: 10px; }
  .pomodoro-status { font-size: 1rem; color: var(--text-light); margin-bottom: 20px; }
  .pomodoro-controls button { margin: 0 5px; padding: 10px 20px; border-radius: 10px; font-size: 0.9rem; font-weight: 700; cursor: pointer; }
  .pomodoro-controls .btn-start { background: var(--success); color: white; border: none; }
  .pomodoro-controls .btn-pause { background: #FFB300; color: white; border: none; }
  .pomodoro-controls .btn-reset { background: #EF5350; color: white; border: none; }
  .pomodoro-total-focus { font-size: 0.85rem; color: var(--text-light); margin-top: 15px; }

  /* Relat√≥rio */
  .report-section { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #EEF2F7; }
  .report-section:last-child { border-bottom: none; }
  .report-section h3 { font-size: 1.1rem; color: var(--primary); margin-bottom: 10px; }
  .report-item { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; }
  .report-item span:first-child { color: var(--text-light); }
  .report-item span:last-child { font-weight: 600; color: var(--text); }
  .report-summary { font-size: 0.95rem; line-height: 1.5; }
  .report-summary strong { color: var(--primary); }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>üß† TDAH Care</h1>
    <span id="header-date"></span>
  </div>
  <div style="font-size:2rem;">üë§</div>
</div>

<!-- HOME -->
<div class="page active" id="page-home">
  <div class="greeting">
    <h2 id="greeting-text">Ol√°! üëã</h2>
    <p>Acompanhe seu dia com TDAH</p>
  </div>

  <div class="stats-row">
    <div class="stat-card"><div class="stat-icon">üò¥</div><div class="stat-value" id="stat-sono">‚Äî</div><div class="stat-label">Sono</div></div>
    <div class="stat-card"><div class="stat-icon">‚úÖ</div><div class="stat-value" id="stat-metas">0/0</div><div class="stat-label">Metas</div></div>
    <div class="stat-card"><div class="stat-icon">üíä</div><div class="stat-value" id="stat-remedio">‚Äî</div><div class="stat-label">Rem√©dio</div></div>
  </div>

  <div class="remedio-card">
    <div class="remedio-header">
      <div>
        <div class="remedio-title">üíä Venvanse (Lisdexanfetamina)</div>
        <div style="font-size:0.75rem;color:var(--text-light);">Dura√ß√£o: 12 horas</div>
      </div>
      <span class="remedio-badge badge-inativo" id="remedio-badge">N√£o registrado</span>
    </div>

    <div id="remedio-sem-registro">
      <p style="font-size:0.82rem;color:var(--text-light);margin-bottom:10px;">Registre o hor√°rio que tomou o rem√©dio:</p>
      <div class="time-input-wrap">
        <input type="time" id="hora-remedio">
        <button onclick="registrarRemedio()">üíä Tomei</button>
      </div>
    </div>

    <div id="remedio-com-registro" style="display:none;">
      <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:8px;">
        <span style="color:var(--text-light);">Tomado √†s <strong id="hora-tomada-display">‚Äî</strong></span>
        <span style="color:var(--text-light);">Encerra √†s <strong id="hora-encerra-display">‚Äî</strong></span>
      </div>
      <div class="remedio-progress-bar">
        <div class="remedio-progress-fill" id="remedio-fill" style="width:0%"></div>
      </div>
      <div class="remedio-info-row">
        <span id="tempo-ativo-label">0h no organismo</span>
        <span id="tempo-restante-label">12h restantes</span>
      </div>
      <div class="remedio-stats">
        <div class="remedio-stat"><div class="val" id="tempo-ativo-val">0h 00min</div><div class="lbl">Tempo ativo</div></div>
        <div class="remedio-stat"><div class="val" id="tempo-restante-val">12h 00min</div><div class="lbl">Tempo restante</div></div>
      </div>
      <div class="aviso-encerrado" id="aviso-encerrado">
        <h4>‚ö†Ô∏è Efeito do rem√©dio encerrado</h4>
        <p>O Venvanse completou suas 12h de a√ß√£o. √â normal sentir:<br><br>
        ‚Ä¢ <strong>Cansa√ßo ou rebote</strong> ‚Äî retorno dos sintomas por 1-2h.<br>
        ‚Ä¢ <strong>Irritabilidade leve</strong> ‚Äî efeito comum ao fim da a√ß√£o.<br>
        ‚Ä¢ <strong>Fome</strong> ‚Äî o apetite retorna ap√≥s a supress√£o.<br><br>
        üí° <strong>Dica:</strong> Evite tarefas de alto foco agora. Descanse e alimente-se bem.</p>
      </div>
      <button class="btn-danger" onclick="resetarRemedio()">üîÑ Registrar nova dose</button>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üìä Progresso de hoje</div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
    <div class="progress-info">
      <span id="progress-text">0 de 0 metas conclu√≠das</span>
      <span id="progress-pct">0%</span>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üìÖ √öltimo sono registrado</div>
    <div id="ultimo-sono-home"><p style="color:var(--text-light);font-size:0.85rem;text-align:center;padding:8px;">Nenhum registro ainda</p></div>
  </div>
</div>

<!-- SONO -->
<div class="page" id="page-sono">
  <div class="section-title">üò¥ Registrar Sono</div>
  <div class="card">
    <div class="sono-visual">
      <div class="sono-circle">
        <span class="horas" id="sono-display">‚Äî</span>
        <span class="label">de sono</span>
      </div>
      <div class="sono-info">
        <p>Recomendado: <strong>7-9 horas</strong></p>
        <p style="font-size:0.8rem;color:var(--text-light);margin-top:6px;">Sono regular melhora foco e resposta ao medicamento.</p>
      </div>
    </div>
    <div class="form-group">
      <label>‚è∞ Quantas horas dormiu?</label>
      <div class="hours-grid" id="hours-grid"></div>
      <div class="custom-hours">
        <input type="number" id="horas-custom" placeholder="Outro valor..." min="0" max="24" step="0.5" oninput="selecionarHoraCustom(this.value)">
        <span>horas</span>
      </div>
    </div>
    <div class="form-group">
      <label>üò¥ Qualidade do sono</label>
      <select id="sono-qualidade">
        <option value="otima">üòä √ìtima ‚Äî Acordei muito descansado</option>
        <option value="boa" selected>üôÇ Boa ‚Äî Acordei bem</option>
        <option value="regular">üòê Regular ‚Äî Cansado mas ok</option>
        <option value="ruim">üòî Ruim ‚Äî Muito cansado</option>
        <option value="pessima">üò´ P√©ssima ‚Äî Mal consegui dormir</option>
      </select>
    </div>
    <div class="form-group">
      <label>üìù Observa√ß√µes (opcional)</label>
      <textarea id="sono-obs" placeholder="Ex: Acordei v√°rias vezes..."></textarea>
    </div>
    <button class="btn btn-primary" onclick="salvarSono()">üíæ Salvar Registro</button>
  </div>
  <div class="card">
    <div class="card-title">üìÖ √öltimos registros</div>
    <div id="historico-sono"><p style="color:var(--text-light);font-size:0.85rem;text-align:center;padding:10px;">Nenhum registro ainda</p></div>
  </div>
</div>

<!-- METAS -->
<div class="page" id="page-metas">
  <div class="section-title">üéØ Minhas Metas</div>
  <div class="card">
    <div class="card-title">‚ûï Nova meta</div>
    <div class="add-meta">
      <input type="text" id="nova-meta-input" placeholder="Ex: Beber √°gua, Meditar...">
      <button onclick="adicionarMeta()">+</button>
    </div>
  </div>
  <div class="card">
    <div class="card-title">üìã Metas de hoje</div>
    <div class="progress-bar" style="margin-bottom:8px;"><div class="progress-fill" id="meta-progress" style="width:0%"></div></div>
    <div class="progress-info" style="margin-bottom:16px;"><span id="meta-info">0 conclu√≠das</span><span id="meta-pct">0%</span></div>
    <div id="lista-metas"></div>
    <div class="divider"></div>
    <button class="btn btn-outline" onclick="limparConcluidas()" style="margin-top:8px;">üóëÔ∏è Limpar conclu√≠das</button>
  </div>
  <div class="card">
    <div class="card-title">üí° Dica</div>
    <div style="background:#FFF8E1;border-left:4px solid #FFB300;border-radius:0 12px 12px 0;padding:12px 16px;font-size:0.83rem;color:#5D4037;line-height:1.5;">
      <strong>TDAH e metas:</strong> Divida tarefas grandes em passos pequenos. Cada ‚úÖ libera dopamina!
    </div>
  </div>
</div>

<!-- MODO CAVERNA -->
<div class="page" id="page-caverna">
  <div class="section-title">‚õ∞Ô∏è Modo Caverna (Pomodoro)</div>
  <div class="card pomodoro-card">
    <div class="pomodoro-timer" id="pomodoro-timer">20:00</div>
    <div class="pomodoro-status" id="pomodoro-status">Foco</div>
    <div class="pomodoro-controls">
      <button class="btn-start" id="pomodoro-start-btn" onclick="startPomodoro()">‚ñ∂Ô∏è Iniciar</button>
      <button class="btn-pause" id="pomodoro-pause-btn" onclick="pausePomodoro()" style="display:none;">‚è∏Ô∏è Pausar</button>
      <button class="btn-reset" id="pomodoro-reset-btn" onclick="resetPomodoro()">‚èπÔ∏è Resetar</button>
    </div>
    <div class="pomodoro-total-focus">Foco total hoje: <strong id="total-focus-time">0h 00min</strong></div>
  </div>
  <div class="card">
    <div class="card-title">üí° Dica</div>
    <div style="background:#F0F7FF;border-left:4px solid var(--primary);border-radius:0 12px 12px 0;padding:12px 16px;font-size:0.83rem;color:var(--text-light);line-height:1.5;">
      O <strong>Modo Caverna</strong> ajuda a manter o foco. Use fones de ouvido e elimine distra√ß√µes!
    </div>
  </div>
</div>

<!-- RELAT√ìRIO -->
<div class="page" id="page-relatorio">
  <div class="section-title">üìä Relat√≥rio Di√°rio</div>
  <div class="card">
    <div class="form-group">
      <label for="celular-tempo">üì± Tempo de uso do celular hoje (horas)</label>
      <input type="number" id="celular-tempo" placeholder="Ex: 3.5" min="0" step="0.1" onchange="salvarCelularTempo()">
    </div>
    <button class="btn btn-primary" onclick="gerarRelatorio()">Gerar Relat√≥rio do Dia</button>
  </div>

  <div class="card" id="relatorio-output" style="display:none; margin-top: 20px;">
    <div class="card-title">Resumo do Dia <span id="relatorio-data"></span></div>

    <div class="report-section">
      <h3>üíä Medica√ß√£o</h3>
      <div id="relatorio-remedio"></div>
    </div>

    <div class="report-section">
      <h3>üò¥ Sono</h3>
      <div id="relatorio-sono"></div>
    </div>

    <div class="report-section">
      <h3>üéØ Metas</h3>
      <div id="relatorio-metas"></div>
    </div>

    <div class="report-section">
      <h3>‚õ∞Ô∏è Foco (Modo Caverna)</h3>
      <div id="relatorio-foco"></div>
    </div>

    <div class="report-section">
      <h3>üì± Uso de Celular</h3>
      <div id="relatorio-celular"></div>
    </div>

    <div class="report-summary" id="relatorio-conclusao"></div>
  </div>
</div>


<!-- INFO -->
<div class="page" id="page-info">
  <div class="section-title">üìö Informa√ß√µes</div>
  <div class="info-tabs">
    <button class="info-tab active" onclick="switchInfo('sono',this)">üò¥ Sono</button>
    <button class="info-tab" onclick="switchInfo('eletrolitos',this)">üíß Eletr√≥litos</button>
    <button class="info-tab" onclick="switchInfo('remedio',this)">üíä Medica√ß√£o</button>
    <button class="info-tab" onclick="switchInfo('estrategias',this)">üß† Estrat√©gias</button>
  </div>
  <div class="info-content active" id="info-sono">
    <div class="info-card"><h3>üåô Por que o sono √© crucial no TDAH?</h3><p>Priva√ß√£o de sono agrava desaten√ß√£o, impulsividade e regula√ß√£o emocional ‚Äî j√° comprometidas no TDAH.</p></div>
    <div class="info-tip"><strong>‚úÖ Recomenda√ß√£o:</strong> 7-9 horas com hor√°rios consistentes, mesmo nos fins de semana.</div>
    <div class="info-card"><h3>üì± Higiene do sono</h3><p>Evite telas 1 hora antes de dormir. A luz azul inibe a melatonina. Crie rotina: banho morno, leitura leve, ambiente fresco.</p></div>
    <div class="info-tip"><strong>‚ö†Ô∏è Aten√ß√£o:</strong> Estimulantes tomados tarde dificultam o sono. Converse com seu m√©dico.</div>
  </div>
  <div class="info-content" id="info-eletrolitos">
    <div class="info-card"><h3>üíß Hidrata√ß√£o e TDAH</h3><p>Desidrata√ß√£o leve (1-2%) j√° impacta concentra√ß√£o e mem√≥ria ‚Äî fun√ß√µes comprometidas no TDAH.</p></div>
    <div class="info-tip"><strong>‚úÖ Meta:</strong> 2-3 litros de √°gua por dia.</div>
    <div class="info-card"><h3>üßÇ Eletr√≥litos importantes</h3><p><strong>Magn√©sio:</strong> Reduz hiperatividade, melhora sono.<br><br><strong>Zinco:</strong> Relacionado √† s√≠ntese de dopamina.<br><br><strong>Ferro:</strong> Defici√™ncia agrava TDAH. Avalie com seu m√©dico.</p></div>
    <div class="info-tip"><strong>‚ö†Ô∏è Importante:</strong> N√£o inicie suplementa√ß√£o sem orienta√ß√£o m√©dica.</div>
  </div>
  <div class="info-content" id="info-remedio">
    <div class="info-card"><h3>üíä Venvanse ‚Äî Como funciona</h3><p>Pr√≥-f√°rmaco ativado no organismo. In√≠cio em 1-2h, pico entre 3-5h, dura√ß√£o total de at√© 12h.</p></div>
    <div class="info-tip"><strong>‚úÖ Hor√°rio ideal:</strong> Tome ao acordar. Consist√™ncia maximiza o efeito terap√™utico.</div>
    <div class="info-card"><h3>üçΩÔ∏è Alimenta√ß√£o e medica√ß√£o</h3><p>Estimulantes reduzem apetite. Tome caf√© da manh√£ nutritivo ANTES da dose. Planeje refei√ß√µes mesmo sem fome.</p></div>
    <div class="info-tip"><strong>‚ö†Ô∏è Nunca</strong> ajuste doses sem consultar seu m√©dico.</div>
    <div class="info-card"><h3>üåô Rebote ao fim do efeito</h3><p>Retorno dos sintomas, irritabilidade leve e fome s√£o normais. Planeje atividades de menor demanda cognitiva para esse per√≠odo.</p></div>
  </div>
  <div class="info-content" id="info-estrategias">
    <div class="info-card"><h3>‚è±Ô∏è T√©cnica Pomodoro adaptada</h3><p>25min de foco + 5min de pausa. Para TDAH, comece com 10-15min com pausas programadas.</p></div>
    <div class="info-card"><h3>üìù Body doubling</h3><p>Estudar na presen√ßa de outra pessoa (mesmo virtual) aumenta foco no TDAH.</p></div>
    <div class="info-tip"><strong>‚úÖ Organiza√ß√£o:</strong> Listas curtas de 3-5 itens. Muitas tarefas vis√≠veis sobrecarregam.</div>
    <div class="info-card"><h3>üéµ M√∫sica e foco</h3><p>Lo-fi, instrumentais ou ru√≠do branco melhoram concentra√ß√£o. Evite letras em tarefas de leitura.</p></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="nav">
  <button class="nav-btn active" onclick="navigate('home',this)"><span class="icon">üè†</span><span>In√≠cio</span></button>
  <button class="nav-btn" onclick="navigate('sono',this)"><span class="icon">üò¥</span><span>Sono</span></button>
  <button class="nav-btn" onclick="navigate('metas',this)"><span class="icon">üéØ</span><span>Metas</span></button>
  <button class="nav-btn" onclick="navigate('caverna',this)"><span class="icon">‚õ∞Ô∏è</span><span>Caverna</span></button>
  <button class="nav-btn" onclick="navigate('relatorio',this)"><span class="icon">üìä</span><span>Relat√≥rio</span></button>
  <button class="nav-btn" onclick="navigate('info',this)"><span class="icon">üìö</span><span>Info</span></button>
</div>

<script>
  const DURACAO = 12 * 60; // Dura√ß√£o do rem√©dio em minutos
  const METAS_DEFAULT = [
    { id:1, texto:'Tomar medica√ß√£o', done:false },
    { id:2, texto:'Beber 2L de √°gua', done:false },
    { id:3, texto:'Fazer 30min de exerc√≠cio', done:false },
    { id:4, texto:'Dormir antes das 23h', done:false },
  ];

  // ===== STATE =====
  let state = {
    sono: [],
    horasSono: null,
    metas: [], // Metas do dia atual
    metasHistorico: {}, // Hist√≥rico de metas por data
    remedio: null,
    timer: null,
    lastAccessedDate: null, // Para controle de reset di√°rio
    pomodoro: {
      totalFocusToday: 0, // Tempo total de foco em segundos
      timer: null,
      minutes: 20,
      seconds: 0,
      isFocus: true,
      isRunning: false,
      currentCycle: 0, // 0: stopped, 1: focus, 2: break
      intervalId: null
    },
    celularTempo: null // Tempo de uso do celular
  };

  // ===== STORAGE =====
  function salvarStorage() {
    try {
      localStorage.setItem('tdah_state', JSON.stringify(state));
    } catch(e) {
      console.error("Erro ao salvar no localStorage:", e);
    }
  }

  function carregarStorage() {
    try {
      const storedState = localStorage.getItem('tdah_state');
      if (storedState) {
        const parsedState = JSON.parse(storedState);
        // Restaurar objetos Date
        if (parsedState.remedio && parsedState.remedio.horaRegistro) {
          parsedState.remedio.horaRegistro = new Date(parsedState.remedio.horaRegistro);
        }
        if (parsedState.lastAccessedDate) {
          parsedState.lastAccessedDate = new Date(parsedState.lastAccessedDate);
        }
        state = { ...state, ...parsedState };
      }
    } catch(e) {
      console.error("Erro ao carregar do localStorage:", e);
    }
  }

  // ===== INIT =====
  function init() {
    carregarStorage();
    checkDailyReset(); // Verifica e reseta metas se for um novo dia

    const now = new Date();
    document.getElementById('header-date').textContent = now.toLocaleDateString('pt-BR', { weekday:'long', day:'numeric', month:'long' });
    const h = now.getHours();
    document.getElementById('greeting-text').textContent = h < 12 ? 'Bom dia! üëã' : h < 18 ? 'Boa tarde! üëã' : 'Boa noite! üëã';
    buildHoursGrid();
    renderMetas();
    renderHistoricoSono();
    updateStats();
    updatePomodoroDisplay();
    updateTotalFocusTime();
    loadCelularTempo();

    // Restaurar rem√©dio se existir
    if (state.remedio) {
      document.getElementById('remedio-sem-registro').style.display = 'none';
      document.getElementById('remedio-com-registro').style.display = 'block';
      atualizarBarra();
      state.timer = setInterval(atualizarBarra, 30000);
    }
  }

  // ===== DAILY RESET =====
  function checkDailyReset() {
    const today = new Date();
    today.setHours(0, 0, 0, 0); // Zera a hora para comparar apenas a data

    let lastAccessed = state.lastAccessedDate;
    if (lastAccessed) {
      lastAccessed.setHours(0, 0, 0, 0);
    }

    // Se √© um novo dia ou nunca foi acessado antes
    if (!lastAccessed || today.getTime() > lastAccessed.getTime()) {
      // Salva as metas do dia anterior no hist√≥rico antes de resetar
      if (state.metas.length > 0) {
        const yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);
        const yesterdayKey = yesterday.toISOString().split('T')[0];
        state.metasHistorico[yesterdayKey] = [...state.metas];
      }

      // Reseta as metas para o dia atual (mant√©m as metas, mas desmarca como done)
      state.metas = state.metas.map(meta => ({ ...meta, done: false }));
      if (state.metas.length === 0) { // Se n√£o havia metas, adiciona as default
        state.metas = [...METAS_DEFAULT];
      }

      // Reseta o tempo de foco do pomodoro
      state.pomodoro.totalFocusToday = 0;
      state.celularTempo = null; // Reseta o tempo de celular

      showToast('üéâ Metas di√°rias resetadas!');
    }
    state.lastAccessedDate = new Date(); // Atualiza a data do √∫ltimo acesso
    salvarStorage();
  }

  // ===== NAV =====
  function navigate(p, btn) {
    document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(x => x.classList.remove('active'));
    document.getElementById('page-' + p).classList.add('active');
    btn.classList.add('active');
    if (p === 'relatorio') {
      document.getElementById('relatorio-output').style.display = 'none'; // Esconde o relat√≥rio ao navegar para a p√°gina
    }
  }

  // ===== REM√âDIO =====
  function registrarRemedio() {
    const val = document.getElementById('hora-remedio').value;
    if (!val) { showToast('‚ö†Ô∏è Informe o hor√°rio que tomou!'); return; }
    const [hh, mm] = val.split(':').map(Number);
    const now = new Date();
    const reg = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh, mm, 0);
    state.remedio = { horaRegistro: reg };
    salvarStorage();
    document.getElementById('remedio-sem-registro').style.display = 'none';
    document.getElementById('remedio-com-registro').style.display = 'block';
    atualizarBarra();
    if (state.timer) clearInterval(state.timer);
    state.timer = setInterval(atualizarBarra, 30000);
    showToast('üíä Medica√ß√£o registrada e salva!');
    updateStats();
  }

  function atualizarBarra() {
    if (!state.remedio) return;
    const agora = new Date();
    const minPass = Math.floor((agora - state.remedio.horaRegistro) / 60000);
    const minRest = Math.max(0, DURACAO - minPass);
    const pct = Math.min(100, (minPass / DURACAO) * 100);
    const horaEnc = new Date(state.remedio.horaRegistro.getTime() + DURACAO * 60000);

    document.getElementById('hora-tomada-display').textContent = fmt(state.remedio.horaRegistro);
    document.getElementById('hora-encerra-display').textContent = fmt(horaEnc);
    document.getElementById('remedio-fill').style.width = pct + '%';

    let cor = pct < 40 ? 'linear-gradient(90deg,#1565C0,#42A5F5)'
            : pct < 75 ? 'linear-gradient(90deg,#1976D2,#26C6DA)'
            : pct < 100 ? 'linear-gradient(90deg,#F57F17,#FFCA28)'
            : 'linear-gradient(90deg,#C62828,#EF5350)';
    document.getElementById('remedio-fill').style.background = cor;

    const hA = Math.floor(minPass/60), mA = minPass%60;
    const hR = Math.floor(minRest/60), mR = minRest%60;

    document.getElementById('tempo-ativo-val').textContent = `${hA}h ${pad(mA)}min`;
    document.getElementById('tempo-restante-val').textContent = minRest > 0 ? `${hR}h ${pad(mR)}min` : 'Encerrado';
    document.getElementById('tempo-ativo-label').textContent = `${hA}h no organismo`;
    document.getElementById('tempo-restante-label').textContent = minRest > 0 ? `${hR}h restantes` : 'Efeito encerrado';

    const badge = document.getElementById('remedio-badge');
    const aviso = document.getElementById('aviso-encerrado');

    if (minRest <= 0) {
      badge.textContent = 'Encerrado'; badge.className = 'remedio-badge badge-encerrado';
      aviso.classList.add('show');
      document.getElementById('stat-remedio').textContent = 'Enc.';
    } else {
      badge.textContent = 'Ativo'; badge.className = 'remedio-badge badge-ativo';
      aviso.classList.remove('show');
      document.getElementById('stat-remedio').textContent = `${hA}h`;
    }
  }

  function resetarRemedio() {
    state.remedio = null;
    salvarStorage();
    if (state.timer) clearInterval(state.timer);
    document.getElementById('remedio-sem-registro').style.display = 'block';
    document.getElementById('remedio-com-registro').style.display = 'none';
    document.getElementById('remedio-badge').textContent = 'N√£o registrado';
    document.getElementById('remedio-badge').className = 'remedio-badge badge-inativo';
    document.getElementById('aviso-encerrado').classList.remove('show');
    document.getElementById('hora-remedio').value = '';
    document.getElementById('stat-remedio').textContent = '‚Äî';
    showToast('üîÑ Pronto para nova dose');
  }

  function fmt(d) { return d.toLocaleTimeString('pt-BR', { hour:'2-digit', minute:'2-digit' }); }
  function pad(n) { return String(n).padStart(2,'0'); }

  // ===== SONO =====
  function buildHoursGrid() {
    const grid = document.getElementById('hours-grid');
    grid.innerHTML = [4,5,6,7,8,9,10,11].map(h =>
      `<button class="hour-btn" onclick="selecionarHora(${h},this)">${h}h</button>`
    ).join('');
  }

  function selecionarHora(h, btn) {
    document.querySelectorAll('.hour-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    state.horasSono = h;
    document.getElementById('sono-display').textContent = h + 'h';
    document.getElementById('horas-custom').value = '';
  }

  function selecionarHoraCustom(val) {
    document.querySelectorAll('.hour-btn').forEach(b => b.classList.remove('selected'));
    state.horasSono = parseFloat(val) || null;
    if (state.horasSono) {
      const h = Math.floor(state.horasSono), m = (state.horasSono % 1) * 60;
      document.getElementById('sono-display').textContent = m > 0 ? `${h}h${m}` : `${h}h`;
    }
  }

  function salvarSono() {
    if (!state.horasSono) { showToast('‚ö†Ô∏è Selecione quantas horas dormiu!'); return; }
    state.sono.unshift({
      data: new Date().toLocaleDateString('pt-BR'),
      horas: state.horasSono,
      qualidade: document.getElementById('sono-qualidade').value,
      obs: document.getElementById('sono-obs').value
    });
    if (state.sono.length > 7) state.sono = state.sono.slice(0,7); // Mant√©m os √∫ltimos 7 registros
    salvarStorage();
    document.getElementById('sono-obs').value = '';
    state.horasSono = null;
    document.querySelectorAll('.hour-btn').forEach(b => b.classList.remove('selected'));
    document.getElementById('sono-display').textContent = '‚Äî';
    document.getElementById('horas-custom').value = '';
    renderHistoricoSono();
    updateStats();
    showToast('‚úÖ Sono salvo!');
  }

  function renderHistoricoSono() {
    const c = document.getElementById('historico-sono');
    const h = document.getElementById('ultimo-sono-home');
    if (!state.sono.length) {
      const msg = '<p style="color:var(--text-light);font-size:0.85rem;text-align:center;padding:10px;">Nenhum registro ainda</p>';
      c.innerHTML = msg; h.innerHTML = msg; return;
    }
    const qMap = { otima:'üòä √ìtima', boa:'üôÇ Boa', regular:'üòê Regular', ruim:'üòî Ruim', pessima:'üò´ P√©ssima' };
    const bMap = { otima:'badge-good', boa:'badge-good', regular:'badge-warn', ruim:'badge-bad', pessima:'badge-bad' };
    const html = state.sono.map(r => `
      <div class="historico-item">
        <div>
          <div style="font-weight:600;font-size:0.88rem;">${r.data}</div>
          <div class="historico-data">${qMap[r.qualidade]}</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="font-weight:700;color:var(--primary);">${r.horas}h</span>
          <span class="badge ${bMap[r.qualidade]}">${r.horas >= 7 ? 'OK' : 'Baixo'}</span>
        </div>
      </div>`).join('');
    c.innerHTML = html;
    // Para a home, mostrar apenas o √∫ltimo registro
    h.innerHTML = `
      <div class="historico-item">
        <div>
          <div style="font-weight:600;font-size:0.88rem;">${state.sono[0].data}</div>
          <div class="historico-data">${qMap[state.sono[0].qualidade]}</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="font-weight:700;color:var(--primary);">${state.sono[0].horas}h</span>
          <span class="badge ${bMap[state.sono[0].qualidade]}">${state.sono[0].horas >= 7 ? 'OK' : 'Baixo'}</span>
        </div>
      </div>`;
  }

  // ===== METAS =====
  function renderMetas() {
    const c = document.getElementById('lista-metas');
    if (!state.metas.length) {
      c.innerHTML = '<p style="color:var(--text-light);text-align:center;font-size:0.85rem;padding:16px;">Nenhuma meta. Adicione acima!</p>';
      updateMetaProgress(); return;
    }
    c.innerHTML = state.metas.map(m => `
      <div class="meta-item ${m.done?'done':''}" onclick="toggleMeta(${m.id})">
        <div class="meta-check">${m.done?'‚úì':''}</div>
        <div class="meta-text">
          <div class="meta-title" style="${m.done?'text-decoration:line-through;color:var(--text-light)':''}">${m.texto}</div>
          <div class="meta-sub">${m.done?'Conclu√≠da! üéâ':'Toque para concluir'}</div>
        </div>
        <div onclick="event.stopPropagation();removerMeta(${m.id})" style="font-size:1.1rem;color:#B0BEC5;padding:4px;">‚úï</div>
      </div>`).join('');
    updateMetaProgress();
  }

  function toggleMeta(id) {
    const m = state.metas.find(m => m.id === id);
    if (m) { m.done = !m.done; salvarStorage(); renderMetas(); updateStats(); if(m.done) showToast('üéâ Meta conclu√≠da!'); }
  }

  function adicionarMeta() {
    const inp = document.getElementById('nova-meta-input');
    const txt = inp.value.trim();
    if (!txt) { showToast('‚ö†Ô∏è Digite uma meta!'); return; }
    state.metas.push({ id: Date.now(), texto: txt, done: false });
    inp.value = '';
    salvarStorage(); renderMetas(); updateStats();
    showToast('‚úÖ Meta adicionada!');
  }

  function removerMeta(id) {
    state.metas = state.metas.filter(m => m.id !== id);
    salvarStorage(); renderMetas(); updateStats();
    showToast('üóëÔ∏è Meta removida');
  }

  function limparConcluidas() {
    state.metas = state.metas.filter(m => !m.done);
    salvarStorage(); renderMetas(); updateStats();
    showToast('üßπ Conclu√≠das removidas!');
  }

  function updateMetaProgress() {
    const total = state.metas.length, done = state.metas.filter(m=>m.done).length;
    const pct = total > 0 ? Math.round((done/total)*100) : 0;
    document.getElementById('meta-progress').style.width = pct + '%';
    document.getElementById('meta-info').textContent = `${done} conclu√≠da${done!==1?'s':''}`;
    document.getElementById('meta-pct').textContent = pct + '%';
  }

  function updateStats() {
    const total = state.metas.length, done = state.metas.filter(m=>m.done).length;
    const pct = total > 0 ? Math.round((done/total)*100) : 0;
    const ult = state.sono[0];
    document.getElementById('stat-sono').textContent = ult ? ult.horas+'h' : '‚Äî';
    document.getElementById('stat-metas').textContent = `${done}/${total}`;
    document.getElementById('progress-fill').style.width = pct + '%';
    document.getElementById('progress-text').textContent = `${done} de ${total} metas conclu√≠das`;
    document.getElementById('progress-pct').textContent = pct + '%';
  }

  // ===== MODO CAVERNA (POMODORO) =====
  function updatePomodoroDisplay() {
    const minutes = state.pomodoro.minutes;
    const seconds = state.pomodoro.seconds;
    document.getElementById('pomodoro-timer').textContent = `${pad(minutes)}:${pad(seconds)}`;
    document.getElementById('pomodoro-status').textContent = state.pomodoro.isFocus ? 'Foco' : 'Descanso';

    const startBtn = document.getElementById('pomodoro-start-btn');
    const pauseBtn = document.getElementById('pomodoro-pause-btn');

    if (state.pomodoro.isRunning) {
      startBtn.style.display = 'none';
      pauseBtn.style.display = 'inline-block';
    } else {
      startBtn.style.display = 'inline-block';
      pauseBtn.style.display = 'none';
    }
  }

  function startPomodoro() {
    if (state.pomodoro.isRunning) return;

    state.pomodoro.isRunning = true;
    if (state.pomodoro.currentCycle === 0) { // Inicia um novo ciclo
      state.pomodoro.isFocus = true;
      state.pomodoro.minutes = 20;
      state.pomodoro.seconds = 0;
      state.pomodoro.currentCycle = 1; // Foco
    }

    updatePomodoroDisplay();
    state.pomodoro.intervalId = setInterval(pomodoroTick, 1000);
    showToast(state.pomodoro.isFocus ? '‚ñ∂Ô∏è Foco iniciado!' : '‚ñ∂Ô∏è Descanso iniciado!');
    salvarStorage();
  }

  function pausePomodoro() {
    if (!state.pomodoro.isRunning) return;

    state.pomodoro.isRunning = false;
    clearInterval(state.pomodoro.intervalId);
    showToast('‚è∏Ô∏è Pomodoro pausado.');
    updatePomodoroDisplay();
    salvarStorage();
  }

  function resetPomodoro() {
    clearInterval(state.pomodoro.intervalId);
    state.pomodoro.isRunning = false;
    state.pomodoro.isFocus = true;
    state.pomodoro.minutes = 20;
    state.pomodoro.seconds = 0;
    state.pomodoro.currentCycle = 0;
    updatePomodoroDisplay();
    showToast('‚èπÔ∏è Pomodoro resetado.');
    salvarStorage();
  }

  function pomodoroTick() {
    if (!state.pomodoro.isRunning) return;

    if (state.pomodoro.isFocus) {
      state.pomodoro.totalFocusToday++; // Incrementa o foco total
      updateTotalFocusTime();
    }

    if (state.pomodoro.seconds === 0) {
      if (state.pomodoro.minutes === 0) {
        // Tempo acabou
        clearInterval(state.pomodoro.intervalId);
        state.pomodoro.isRunning = false;

        if (state.pomodoro.isFocus) {
          showToast('üîî Foco conclu√≠do! Hora do descanso.');
          state.pomodoro.isFocus = false;
          state.pomodoro.minutes = 5; // 5 minutos de descanso
          state.pomodoro.seconds = 0;
          state.pomodoro.currentCycle = 2; // Descanso
        } else {
          showToast('üîî Descanso conclu√≠do! Hora de outro foco.');
          state.pomodoro.isFocus = true;
          state.pomodoro.minutes = 20; // 20 minutos de foco
          state.pomodoro.seconds = 0;
          state.pomodoro.currentCycle = 1; // Foco
        }
        updatePomodoroDisplay();
        // Opcional: iniciar automaticamente o pr√≥ximo ciclo
        // startPomodoro();
      } else {
        state.pomodoro.minutes--;
        state.pomodoro.seconds = 59;
      }
    } else {
      state.pomodoro.seconds--;
    }
    updatePomodoroDisplay();
    salvarStorage();
  }

  function updateTotalFocusTime() {
    const totalSeconds = state.pomodoro.totalFocusToday;
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    document.getElementById('total-focus-time').textContent = `${hours}h ${pad(minutes)}min`;
  }

  // ===== CELULAR TEMPO =====
  function salvarCelularTempo() {
    const input = document.getElementById('celular-tempo');
    const value = parseFloat(input.value);
    if (!isNaN(value) && value >= 0) {
      state.celularTempo = value;
      salvarStorage();
      showToast('üì± Tempo de celular salvo!');
    } else if (input.value !== '') {
      showToast('‚ö†Ô∏è Tempo de celular inv√°lido!');
      state.celularTempo = null;
      salvarStorage();
    } else {
      state.celularTempo = null;
      salvarStorage();
    }
  }

  function loadCelularTempo() {
    const input = document.getElementById('celular-tempo');
    if (state.celularTempo !== null) {
      input.value = state.celularTempo;
    } else {
      input.value = '';
    }
  }

  // ===== RELAT√ìRIO =====
  function gerarRelatorio() {
    const relatorioOutput = document.getElementById('relatorio-output');
    relatorioOutput.style.display = 'block';

    const today = new Date();
    document.getElementById('relatorio-data').textContent = today.toLocaleDateString('pt-BR', { day:'numeric', month:'long', year:'numeric' });

    // 1. Medica√ß√£o
    const relatorioRemedio = document.getElementById('relatorio-remedio');
    if (state.remedio && state.remedio.horaRegistro) {
      const agora = new Date();
      const minPass = Math.floor((agora - state.remedio.horaRegistro) / 60000);
      const hA = Math.floor(minPass/60), mA = minPass%60;
      const horaEnc = new Date(state.remedio.horaRegistro.getTime() + DURACAO * 60000);
      const statusRemedio = minPass <= DURACAO ? 'Ativo' : 'Encerrado';

      relatorioRemedio.innerHTML = `
        <div class="report-item"><span>Tomado √†s:</span><span>${fmt(state.remedio.horaRegistro)}</span></div>
        <div class="report-item"><span>Encerra √†s:</span><span>${fmt(horaEnc)}</span></div>
        <div class="report-item"><span>Tempo ativo:</span><span>${hA}h ${pad(mA)}min</span></div>
        <div class="report-item"><span>Status:</span><span>${statusRemedio}</span></div>
      `;
    } else {
      relatorioRemedio.innerHTML = '<p class="report-summary">Nenhuma medica√ß√£o registrada hoje.</p>';
    }

    // 2. Sono
    const relatorioSono = document.getElementById('relatorio-sono');
    const ultimoSono = state.sono[0];
    if (ultimoSono && ultimoSono.data === today.toLocaleDateString('pt-BR')) {
      const qMap = { otima:'√ìtima', boa:'Boa', regular:'Regular', ruim:'Ruim', pessima:'P√©ssima' };
      relatorioSono.innerHTML = `
        <div class="report-item"><span>Horas dormidas:</span><span>${ultimoSono.horas}h</span></div>
        <div class="report-item"><span>Qualidade:</span><span>${qMap[ultimoSono.qualidade]}</span></div>
        ${ultimoSono.obs ? `<div class="report-item"><span>Observa√ß√µes:</span><span>${ultimoSono.obs}</span></div>` : ''}
      `;
    } else {
      relatorioSono.innerHTML = '<p class="report-summary">Nenhum registro de sono para hoje.</p>';
    }

    // 3. Metas
    const relatorioMetas = document.getElementById('relatorio-metas');
    const totalMetas = state.metas.length;
    const metasConcluidas = state.metas.filter(m => m.done).length;
    if (totalMetas > 0) {
      relatorioMetas.innerHTML = `
        <div class="report-item"><span>Metas criadas:</span><span>${totalMetas}</span></div>
        <div class="report-item"><span>Metas conclu√≠das:</span><span>${metasConcluidas}</span></div>
        <p class="report-summary" style="margin-top:10px;">Progresso: <strong>${metasConcluidas}/${totalMetas}</strong> (${totalMetas > 0 ? Math.round((metasConcluidas/totalMetas)*100) : 0}%)</p>
      `;
    } else {
      relatorioMetas.innerHTML = '<p class="report-summary">Nenhuma meta definida para hoje.</p>';
    }

    // 4. Foco (Modo Caverna)
    const relatorioFoco = document.getElementById('relatorio-foco');
    const totalFocusSeconds = state.pomodoro.totalFocusToday;
    const focusHours = Math.floor(totalFocusSeconds / 3600);
    const focusMinutes = Math.floor((totalFocusSeconds % 3600) / 60);
    relatorioFoco.innerHTML = `
      <div class="report-item"><span>Tempo total de foco:</span><span>${focusHours}h ${pad(focusMinutes)}min</span></div>
      <p class="report-summary" style="margin-top:10px;">Continue focado para aumentar sua produtividade!</p>
    `;

    // 5. Uso de Celular
    const relatorioCelular = document.getElementById('relatorio-celular');
    if (state.celularTempo !== null) {
      relatorioCelular.innerHTML = `
        <div class="report-item"><span>Horas de uso:</span><span>${state.celularTempo}h</span></div>
      `;
    } else {
      relatorioCelular.innerHTML = '<p class="report-summary">Tempo de uso do celular n√£o registrado.</p>';
    }

    // Conclus√£o geral
    const relatorioConclusao = document.getElementById('relatorio-conclusao');
    let conclusaoTexto = "Seu dia foi ";
    if (metasConcluidas / totalMetas >= 0.75 && ultimoSono && ultimoSono.horas >= 7 && (state.remedio && minPass <= DURACAO)) {
      conclusaoTexto += "<strong>muito produtivo e equilibrado!</strong> Continue assim. üéâ";
    } else if (metasConcluidas / totalMetas >= 0.5 || (ultimoSono && ultimoSono.horas >= 6) || (state.remedio && minPass <= DURACAO)) {
      conclusaoTexto += "<strong>bom!</strong> H√° espa√ßo para melhorar, mas voc√™ est√° no caminho certo. üëç";
    } else {
      conclusaoTexto += "<strong>desafiador.</strong> Lembre-se de que cada dia √© uma nova chance para recome√ßar. N√£o desanime! üí™";
    }
    relatorioConclusao.innerHTML = conclusaoTexto;

    showToast('üìä Relat√≥rio gerado!');
  }


  // ===== INFO =====
  function switchInfo(tab, btn) {
    document.querySelectorAll('.info-content').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.info-tab').forEach(b => b.classList.remove('active'));
    document.getElementById('info-' + tab).classList.add('active');
    btn.classList.add('active');
  }

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2500);
  }

  init();
</script>
</body>
</html>
